# VOID E-COMMERCE

[![Backend CI - Python Tests](https://github.com/Timba-SA/VOID-E-COMMERCE/actions/workflows/backend-ci.yml/badge.svg)](https://github.com/Timba-SA/VOID-E-COMMERCE/actions/workflows/backend-ci.yml)
![Python Version](https://img.shields.io/badge/python-3.11-blue.svg)
![Framework](https://img.shields.io/badge/framework-FastAPI-green.svg)
![Frontend](https://img.shields.io/badge/frontend-React-blue.svg)

Una plataforma de e-commerce full-stack para la marca de indumentaria "VOID", construida con un backend robusto y asincr√≥nico en FastAPI y un frontend moderno e interactivo en React.



---

## Tabla de Contenidos
1.  [Descripci√≥n del Proyecto](#1-descripci√≥n-del-proyecto)
2.  [Caracter√≠sticas Principales](#2-caracter√≠sticas-principales)
3.  [Tecnolog√≠as Utilizadas](#3-tecnolog√≠as-utilizadas)
4.  [Prerrequisitos](#4-prerrequisitos)
5.  [Instalaci√≥n y Puesta en Marcha](#5-instalaci√≥n-y-puesta-en-marcha)
6.  [Ejecutando la Aplicaci√≥n](#6-ejecutando-la-aplicaci√≥n)
7.  [Ejecutando los Tests](#7-ejecutando-los-tests)
8.  [Estructura del Proyecto](#8-estructura-del-proyecto)
9.  [Documentaci√≥n de la API](#9-documentaci√≥n-de-la-api)
10. [Integraci√≥n Continua (CI/CD)](#10-integraci√≥n-continua-cicd)
11. [Scripts de Utilidad](#11-scripts-de-utilidad)
12. [Caracter√≠sticas Avanzadas](#12-caracter√≠sticas-avanzadas)
13. [Monitoreo y Logging](#13-monitoreo-y-logging)
14. [Contribuir](#14-contribuir)
15. [Licencia y Contacto](#15-licencia-y-contacto)

---

## 1. Descripci√≥n del Proyecto

**VOID E-COMMERCE** es una soluci√≥n completa para la venta online de indumentaria. La arquitectura est√° dise√±ada para ser escalable, segura y de alto rendimiento, utilizando un stack tecnol√≥gico moderno. 

El backend maneja toda la l√≥gica de negocio, incluyendo:
- ‚úÖ Gesti√≥n de productos con internacionalizaci√≥n (i18n)
- ‚úÖ Autenticaci√≥n JWT robusta
- ‚úÖ Carrito de compras persistente con fusi√≥n autom√°tica
- ‚úÖ Checkout integrado con MercadoPago (webhooks + confirmaci√≥n autom√°tica)
- ‚úÖ Panel de administraci√≥n completo
- ‚úÖ Chatbot IA (Kara) con Groq para asistencia en tiempo real
- ‚úÖ **Worker de emails con IA** para respuestas autom√°ticas a clientes
- ‚úÖ Sistema de cach√© multicapa con Redis
- ‚úÖ Cola de tareas con Celery para procesamiento as√≠ncrono

El frontend, construido con React 18 y Vite, ofrece una experiencia de usuario r√°pida y fluida con soporte multiidioma.

El proyecto ha sido sometido a un riguroso proceso de auditor√≠a y mejora continua, implementando las mejores pr√°cticas de la industria en cuanto a:
- üîí **Seguridad** (rate limiting, JWT, CORS restrictivo)
- ‚ö° **Performance** (cach√© inteligente, lazy loading, pooling optimizado)
- üß™ **Testing** (24 tests automatizados, CI/CD con GitHub Actions)
- üìÅ **Organizaci√≥n** (estructura modular, scripts de utilidad organizados)

---

## 2. Caracter√≠sticas Principales

* **Autenticaci√≥n JWT:** Sistema de registro y login seguro basado en tokens.
* **Cat√°logo de Productos:** Gesti√≥n completa de productos, categor√≠as y variantes (talle, color) con soporte multiidioma (i18n).
* **Carrito de Compras:** Funcionalidad de carrito tanto para usuarios invitados como registrados, con fusi√≥n autom√°tica al iniciar sesi√≥n.
* **Checkout con MercadoPago:** Integraci√≥n completa con la pasarela de pagos de MercadoPago, incluyendo webhooks para confirmaci√≥n autom√°tica de pagos.
* **Panel de Administraci√≥n:** Endpoints protegidos para la gesti√≥n de ventas, usuarios y productos.
* **Chatbot IA (Kara):** Asistente de ventas inteligente integrado con Groq AI para responder consultas en tiempo real, con b√∫squeda sem√°ntica de productos y an√°lisis de intenciones.
* **Worker de Emails con IA:** Sistema automatizado de respuesta a emails de clientes usando IA, con procesamiento as√≠ncrono mediante Celery.
* **Seguridad Mejorada:** Rate Limiting con SlowAPI, autenticaci√≥n robusta y protecci√≥n contra ataques de fuerza bruta.
* **Arquitectura Optimizada:** Cach√© inteligente con Redis (FAQ cache, product cache), cola de tareas con Celery para procesar trabajos pesados en segundo plano.
* **Internacionalizaci√≥n (i18n):** Soporte completo para m√∫ltiples idiomas en productos y categor√≠as.
* **Testing Robusto:** Suite completa de tests automatizados con pytest (24 tests, cobertura completa de routers principales).

---

## 3. Tecnolog√≠as Utilizadas

### Backend (`/server`)
* **Framework:** FastAPI 0.116.2
* **Lenguaje:** Python 3.11
* **Bases de Datos:**
    * PostgreSQL (Supabase) con SQLAlchemy 2.0 para datos transaccionales (√≥rdenes, productos, emails).
    * MongoDB (Motor) para datos no estructurados (usuarios, carritos, conversaciones IA).
* **Asincron√≠a:** Uvicorn como servidor ASGI, arquitectura completamente as√≠ncrona con asyncio.
* **Seguridad:** 
    * Passlib con bcrypt para hashing de contrase√±as
    * JWT (python-jose) para autenticaci√≥n stateless
    * SlowAPI para rate limiting
    * CORS configurado con pol√≠ticas restrictivas
* **Optimizaci√≥n:** 
    * Redis 5.0.7 para cach√© multicapa y broker de Celery
    * FAQ Cache para respuestas instant√°neas
    * Database connection pooling con NullPool (Celery-safe)
* **Tareas en Segundo Plano:** 
    * Celery 5.4.0 con 20 workers concurrentes
    * Worker especializado para procesamiento de emails con IA
    * Dead Letter Queue para reintentos inteligentes
* **IA y Machine Learning:**
    * Groq API con modelo llama-3.1-8b-instant
    * An√°lisis de intenciones y b√∫squeda sem√°ntica de productos
    * Rate limiting IA (8 req/min) con circuit breaker
* **Email:** 
    * IMAP (imap-tools) para recepci√≥n de emails
    * SMTP as√≠ncrono (aiosmtplib) para env√≠o
* **Testing:** 
    * Pytest 8.4.2 con asyncio
    * Mock de Redis para tests independientes
    * Coverage completo de routers principales
* **Monitoreo:** Sentry para seguimiento de errores en producci√≥n.
* **Almacenamiento:** Cloudinary para im√°genes de productos.

### Frontend (`/client`)
* **Framework:** React 18
* **Bundler:** Vite 6.0
* **Lenguaje:** JavaScript (JSX)
* **Estilos:** Tailwind CSS 3.4, PostCSS
* **Internacionalizaci√≥n:** i18next para soporte multiidioma
* **Estado:** Zustand para gesti√≥n de estado global
* **HTTP Client:** Axios con interceptores
* **Routing:** React Router DOM

---

## 4. Prerrequisitos

Para levantar el entorno de desarrollo, necesit√°s tener instalado en tu m√°quina:
* Git
* Python (versi√≥n 3.11 o superior)
* Node.js (versi√≥n 20 o superior)
* Docker y Docker Compose

---

## 5. Instalaci√≥n y Puesta en Marcha

1.  **Clonar el repositorio:**
    ```bash
    git clone [https://github.com/Timba-SA/VOID-E-COMMERCE.git](https://github.com/Timba-SA/VOID-E-COMMERCE.git)
    cd VOID-E-COMMERCE
    ```

2.  **Configurar las Variables de Entorno:**
    * En la **ra√≠z del proyecto**, vas a encontrar un archivo llamado `.env.example`.
    * Hac√© una copia de este archivo y renombrala a `.env`.
    * Abr√≠ el nuevo archivo `.env` y complet√° todas las claves (`SECRET_KEY`, URLs de bases de datos, tokens de APIs, etc.) con tus valores de desarrollo.

---

## 6. Ejecutando la Aplicaci√≥n

La forma recomendada y m√°s simple de levantar todo el entorno de desarrollo es usando Docker Compose.

**Desde la ra√≠z del proyecto**, ejecut√° el siguiente comando:
```bash
docker compose up --build
```
Este comando har√° lo siguiente:

* Construir√° las im√°genes de Docker para el backend, frontend y worker.
* Levantar√° 4 contenedores:
    * **backend:** API FastAPI (puerto 8000)
    * **frontend:** React con Vite (puerto 5173)
    * **redis:** Cache y broker de Celery (puerto 6379)
    * **worker_ia:** Worker de Celery para procesamiento de emails con IA
* La aplicaci√≥n estar√° disponible en las siguientes URLs:
    * Frontend: http://localhost:5173
    * Backend API: http://localhost:8000
    * Documentaci√≥n API: http://localhost:8000/docs


**Nota:** En caso de no usar Docker se puede acceder al proyecto de la siguiente manera.

1. **Levantar Redis localmente** (requerido para cache y rate limiting):
```bash
docker compose up -d redis
```

2. Abrir una terminal desde la carpeta del backend(`server`), crear el entorno virtual y activarlo.
```bash
# Crear el entorno virtual
python -m venv .venv
# Activar el entorno virtual (Windows PowerShell)
.\.venv\Scripts\activate
# Activar el entorno virtual (Linux/Mac)
source .venv/bin/activate
```

3. Una vez dentro del entorno virtual instalar las dependencias y luego ejecutar el backend.
```bash
# Instalar las dependencias
pip install -r requirements-dev.txt
# Ejecutar el backend
python -m uvicorn main:app --reload
```

4. **(Opcional) Levantar el Worker de IA** para procesamiento de emails:
```bash
# En otra terminal, desde server/ con el venv activado
celery -A celery_worker.celery_app worker --loglevel=info --concurrency=20
```

5. **Sin cerrar las terminales del backend**. Abrir otra terminal desde el frontend(`client`), instalar las dependencias de node e inicializar el servidor.
```bash
# Instalar las dependencias de node
npm install
# Inicializar el servidor
npm run dev
```

6. Para ingresar a la aplicaci√≥n utilizar las URLs generadas en las terminales anteriores.

---

## 7. Ejecutando los Tests

Los tests del backend est√°n dise√±ados para correr de forma aislada con mocks de Redis y bases de datos en memoria.

**Para ejecutar la suite completa de tests:**

1. **Navegar a la carpeta del backend:**
```bash
cd server
```

2. **Crear y activar el entorno virtual** (si no lo ten√©s creado):
```bash
# Crear el entorno virtual
python -m venv .venv

# Activar (Windows PowerShell)
.\.venv\Scripts\activate

# Activar (Linux/Mac)
source .venv/bin/activate
```

3. **Instalar dependencias de desarrollo:**
```bash
pip install -r requirements-dev.txt
```

4. **Ejecutar pytest:**
```bash
# Ejecutar todos los tests
python -m pytest

# Ejecutar con verbose para ver detalles
python -m pytest -v

# Ejecutar tests espec√≠ficos
python -m pytest tests/test_auth_router.py -v

# Ejecutar con cobertura
python -m pytest --cov=. --cov-report=html
```

**Resultado esperado:**
```
======================== test session starts ========================
platform win32 -- Python 3.11.9, pytest-8.4.2, pluggy-1.6.0
collected 24 items

test_reset_flow.py .                                          [  4%]
tests/test_auth_router.py .....                               [ 25%]
tests/test_cart_router.py ...                                 [ 37%]
tests/test_checkout_router.py ...                             [ 50%]
tests/test_email_service.py .                                 [ 54%]
tests/test_health_router.py ..                                [ 62%]
tests/test_products_router.py .........                       [100%]

===================== 24 passed in 14.68s =======================
```

**Nota:** Los tests mockean autom√°ticamente Redis y usan bases de datos en memoria (SQLite + mongomock), por lo que **no requieren servicios externos** para ejecutarse.

---

## 8. Estructura del Proyecto

```
VOID-E-COMMERCE/
‚îú‚îÄ‚îÄ client/                    # Frontend React
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/              # Configuraci√≥n de Axios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/       # Componentes React reutilizables
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ context/          # Context API de React
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/            # Custom hooks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/            # P√°ginas principales
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/         # Servicios de API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stores/           # Zustand stores
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/            # Utilidades
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ locales/          # Archivos de traducci√≥n i18n
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ
‚îú‚îÄ‚îÄ server/                    # Backend FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py         # Modelos SQLAlchemy (PostgreSQL)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py       # Configuraci√≥n de conexiones
‚îÇ   ‚îú‚îÄ‚îÄ routers/              # Endpoints de la API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_router.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ products_router.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cart_router.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ checkout_router.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orders_router.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chatbot_router.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ schemas/              # Modelos Pydantic (validaci√≥n)
‚îÇ   ‚îú‚îÄ‚îÄ services/             # L√≥gica de negocio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ia_services.py    # Servicios de IA (Groq)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ email_service.py  # Servicios de email
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cache_service.py  # Gesti√≥n de cach√© Redis
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cloudinary_service.py
‚îÇ   ‚îú‚îÄ‚îÄ workers/              # Workers de Celery
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ email_celery_task.py  # Worker de emails con IA
‚îÇ   ‚îú‚îÄ‚îÄ utils/                # Utilidades generales
‚îÇ   ‚îú‚îÄ‚îÄ tests/                # Tests automatizados (24 tests)
‚îÇ   ‚îú‚îÄ‚îÄ scripts/              # Scripts de utilidad
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/       # Scripts de migraci√≥n de DB
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ diagnostics/      # Scripts de diagn√≥stico
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ performance/      # Scripts de benchmarking
‚îÇ   ‚îú‚îÄ‚îÄ main.py               # Entry point de la aplicaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ settings.py           # Configuraci√≥n (variables de entorno)
‚îÇ   ‚îú‚îÄ‚îÄ celery_worker.py      # Configuraci√≥n de Celery
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îÇ
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îî‚îÄ‚îÄ backend-ci.yml    # Pipeline CI/CD para tests
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml        # Configuraci√≥n de Docker
‚îú‚îÄ‚îÄ .env.example              # Ejemplo de variables de entorno
‚îî‚îÄ‚îÄ README.md
```

---

## 9. Documentaci√≥n de la API

Gracias a FastAPI, la documentaci√≥n de la API se genera autom√°ticamente y est√° siempre actualizada. Una vez que el backend est√© corriendo, pod√©s acceder a ella en:

- Swagger UI: http://localhost:8000/docs

- ReDoc: http://localhost:8000/redoc

---

## 10. Integraci√≥n Continua (CI/CD)
Este proyecto tiene configurado un pipeline de Integraci√≥n Continua (CI) con GitHub Actions. Cada vez que se sube c√≥digo a las ramas `master` o `develop`, se ejecuta autom√°ticamente:

* ‚úÖ **Suite completa de tests** (24 tests)
* ‚úÖ **Verificaci√≥n de linting** con pytest
* ‚úÖ **Validaci√≥n de importaciones** y dependencias
* ‚úÖ **Tests con mocks** de Redis y bases de datos

El badge de CI en la parte superior del README muestra el estado actual del pipeline.

### Pipeline Actual:
- **Plataforma:** GitHub Actions
- **Trigger:** Push a `master` o `develop`
- **Python:** 3.11
- **Tests:** 24 tests automatizados
- **Cobertura:** Routers principales (auth, cart, checkout, products, health, email)

---

## 11. Scripts de Utilidad

El proyecto incluye m√∫ltiples scripts organizados en `/server/scripts/` para facilitar el mantenimiento:

### Migraciones (`scripts/migrations/`)
- Actualizaci√≥n de schemas de base de datos
- Limpieza de datos duplicados
- Migraciones de internacionalizaci√≥n

### Diagn√≥sticos (`scripts/diagnostics/`)
- Verificaci√≥n de estado del sistema
- An√°lisis de √≥rdenes y pagos
- Diagn√≥stico de webhooks de MercadoPago

### Performance (`scripts/performance/`)
- Benchmarking de endpoints
- Optimizaci√≥n de consultas SQL
- Verificaci√≥n de mejoras de cach√©

Ver [`/server/scripts/README.md`](server/scripts/README.md) para documentaci√≥n detallada.

---

## 12. Caracter√≠sticas Avanzadas

### ü§ñ Worker de IA para Emails
- **Procesamiento autom√°tico** de emails de clientes
- **An√°lisis de intenciones** (consulta general, b√∫squeda de producto, FAQ)
- **Respuestas contextuales** con historial de conversaci√≥n
- **Dead Letter Queue** para reintentos inteligentes (max 5 intentos)
- **Rate limiting IA** (8 req/min) con circuit breaker
- **FAQ Cache** para respuestas instant√°neas en 5 categor√≠as

### üéØ Optimizaciones de Performance
- **Cach√© Redis multicapa:**
  - FAQ cache (respuestas instant√°neas)
  - Product cache (TTL: 5 minutos)
  - Category cache
- **Database pooling** optimizado para Celery (NullPool)
- **Lazy loading** con SQLAlchemy selectinload
- **√çndices optimizados** en columnas frecuentemente consultadas

### üåç Internacionalizaci√≥n (i18n)
- Soporte completo para m√∫ltiples idiomas
- Productos y categor√≠as traducidos din√°micamente
- Frontend con i18next para cambio de idioma en tiempo real

### üîí Seguridad
- **Rate Limiting** con SlowAPI (protecci√≥n contra brute force)
- **JWT stateless** con expiraci√≥n configurable
- **CORS restrictivo** solo para or√≠genes autorizados
- **Hashing bcrypt** para contrase√±as
- **Validaci√≥n Pydantic** en todos los inputs

---

## 13. Monitoreo y Logging

### Sentry Integration
- Tracking autom√°tico de errores en producci√≥n
- Contexto completo de cada error (user, request, stack trace)
- Alertas en tiempo real

### Logging Mejorado
- Logs estructurados con emojis para mejor legibilidad:
  - ü§ñ Llamadas a IA
  - üíæ Cache hits
  - ‚ö†Ô∏è Rate limit warnings
  - ‚úÖ Operaciones exitosas
  - ‚ùå Errores
  - üìß Procesamiento de emails

---

## 14. Contribuir

Este proyecto sigue las mejores pr√°cticas de desarrollo:

1. **Crear una rama** para cada feature/fix
2. **Escribir tests** para nuevas funcionalidades
3. **Ejecutar la suite de tests** antes de hacer commit
4. **Usar commits descriptivos** con emojis convencionales
5. **Crear Pull Request** con descripci√≥n detallada

### Comandos √∫tiles:
```bash
# Ejecutar tests
cd server && python -m pytest -v

# Ejecutar con cobertura
python -m pytest --cov=. --cov-report=html

# Formatear c√≥digo (si tienes black instalado)
black .

# Levantar solo un servicio
docker compose up -d redis
docker compose up backend

# Ver logs de un servicio
docker compose logs -f worker_ia
```

---

## 15. Licencia y Contacto

**Proyecto:** VOID E-COMMERCE  
**Organizaci√≥n:** Timba-SA  
**Repositorio:** [github.com/Timba-SA/VOID-E-COMMERCE](https://github.com/Timba-SA/VOID-E-COMMERCE)

Para consultas o contribuciones, abr√≠ un issue en GitHub.

--- 

